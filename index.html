<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard | Finance Tracker</title>
<link rel="stylesheet" href="assets/css/variables.css">
<link rel="stylesheet" href="assets/css/base.css">
<link rel="stylesheet" href="assets/css/layout.css">
<link rel="stylesheet" href="assets/css/components.css">
<link rel="stylesheet" href="assets/css/pages.css">
<style>
.kpi {
  padding: 20px;
  border-radius: 12px;
  background: var(--color-card);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  text-align: center;
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
}

.kpi:hover {
  transform: translateY(-5px); /* Slight lift */
  box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  background: #e0f7fa; /* light teal accent on hover, can adjust */
}


.kpi-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
.kpi { padding:20px; border-radius:12px; background:var(--color-card); box-shadow:0 4px 12px rgba(0,0,0,0.08); text-align:center; }
.kpi h3 { margin-bottom:10px; font-size:1.1rem; color:var(--color-text); }
.kpi p { font-size:1.5rem; font-weight:bold; color:var(--color-accent); }

/* Cards & Tables */
.card { padding:25px; border-radius:12px; margin-bottom:30px; }
.table th, .table td { padding:12px 15px; }
.table tbody tr:not(:last-child) { border-bottom:1px solid #eee; }

/* Theme button */
.theme-btn { position:absolute; top:20px; right:20px; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:var(--color-accent); color:#fff; }

/* Main content spacing */
.main-content { padding:20px; } /* space from toggle button */
.header { margin-bottom:10px; }

/* Welcome message */
#welcomeMessage { margin-bottom:20px; font-size:1.3rem; font-weight:bold; color:var(--color-text); }
</style>
</head>
<body>

<!-- Toggle Dark/Light -->
<button id="themeToggle" class="theme-btn">Toggle Dark / Light</button>

<div class="app">
  <aside class="sidebar">
    <h2>Finance Tracker</h2>
    <nav class="nav">
      <a href="index.html" class="active">Dashboard</a>
      <a href="income.html">Income</a>
      <a href="expenses.html">Expenses</a>
      <a href="categories.html">Categories</a>
      <a href="reports.html">Reports</a>
      <a href="settings.html">Settings</a>
    </nav>
  </aside>

  <main class="main">
    <div class="main-content">
      <!-- Header -->
      <header class="header">
        <h1>Dashboard</h1>
        <div id="currentMonth"></div>
      </header>

      <!-- Dynamic Welcome Message -->
      <div id="welcomeMessage"></div>

      <!-- KPI Cards -->
      <section class="kpi-grid">
        <div class="card kpi"><h3>Current Balance</h3><p id="currentBalance">₦0</p></div>
        <div class="card kpi"><h3>Total Income</h3><p id="totalIncome">₦0</p></div>
        <div class="card kpi"><h3>Total Expenses</h3><p id="totalExpenses">₦0</p></div>
        <div class="card kpi"><h3>Savings Rate</h3><p id="savingsRate">0%</p></div>
      </section>

      <!-- Recent Transactions -->
      <section class="card">
        <h2 class="section-title">Recent Transactions</h2>
        <table class="table">
          <thead>
            <tr><th>Date</th><th>Description</th><th>Category</th><th>Amount</th></tr>
          </thead>
          <tbody id="recentTransactions"></tbody>
        </table>
      </section>
    </div>
  </main>
</div>

<script src="assets/js/theme.js"></script>
<script>
const currentUser = JSON.parse(localStorage.getItem('currentUser'));
if(!currentUser) window.location.href='login.html';

// Dynamic Welcome Message by time
function getTimeGreeting(){
  const hour = new Date().getHours();
  if(hour < 12) return "Good Morning";
  else if(hour < 18) return "Good Afternoon";
  else return "Good Evening";
}
document.getElementById('welcomeMessage').textContent = `${getTimeGreeting()}, ${currentUser.name}!`;

// Current Month
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
document.getElementById('currentMonth').textContent = monthNames[new Date().getMonth()] + ' ' + new Date().getFullYear();

// Load Dashboard Data
function loadDashboard(){
  const incomes = (JSON.parse(localStorage.getItem('incomes')) || []).filter(t=>t.userEmail===currentUser.email);
  const expenses = (JSON.parse(localStorage.getItem('expenses')) || []).filter(t=>t.userEmail===currentUser.email);

  const totalIncome = incomes.reduce((sum,t)=>sum+parseFloat(t.amount),0);
  const totalExpenses = expenses.reduce((sum,t)=>sum+parseFloat(t.amount),0);
  const balance = totalIncome-totalExpenses;
  const savingsRate = totalIncome>0 ? Math.round((balance/totalIncome)*100):0;

  document.getElementById('totalIncome').textContent = '₦'+totalIncome.toLocaleString();
  document.getElementById('totalExpenses').textContent = '₦'+totalExpenses.toLocaleString();
  document.getElementById('currentBalance').textContent = '₦'+balance.toLocaleString();
  document.getElementById('savingsRate').textContent = savingsRate+'%';

  const allTransactions = [...incomes.map(t=>({...t,type:'income'})), ...expenses.map(t=>({...t,type:'expense'}))];
  allTransactions.sort((a,b)=>new Date(b.date)-new Date(a.date));

  const recent = allTransactions.slice(0,5);
  const tbody = document.getElementById('recentTransactions');
  tbody.innerHTML='';
  recent.forEach(t=>{
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${t.date}</td>
      <td>${t.description}</td>
      <td>${t.category}</td>
      <td style="color:${t.type==='income'?'var(--color-accent)':'var(--color-danger)'}">
        ${t.type==='income'?'+':'-'} ₦${parseFloat(t.amount).toLocaleString()}
      </td>
    `;
    tbody.appendChild(row);
  });
}

loadDashboard();
window.addEventListener('storage', loadDashboard);
</script>
</body>
</html>
